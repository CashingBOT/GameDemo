!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).Core={})}(this,function(e){"use strict";var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function t(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function n(e,t,n,i){var s,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;0<=a;a--)(s=e[a])&&(r=(o<3?s(r):3<o?s(t,n,r):s(t,n))||r);return 3<o&&r&&Object.defineProperty(t,n,r),r}function a(e,r,a,c){return new(a=a||Promise)(function(n,t){function i(e){try{o(c.next(e))}catch(e){t(e)}}function s(e){try{o(c.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(i,s)}o((c=c.apply(e,r||[])).next())})}function v(n,i){var s,o,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(s)throw new TypeError("Generator is already executing.");for(;a;)try{if(s=1,o&&(r=2&t[0]?o.return:t[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,t[1])).done)return r;switch(o=0,r&&(t=[2&t[0],r.value]),t[0]){case 0:case 1:r=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,o=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(r=0<(r=a.trys).length&&r[r.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!r||t[1]>r[0]&&t[1]<r[3])){a.label=t[1];break}if(6===t[0]&&a.label<r[1]){a.label=r[1],r=t;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(t);break}r[2]&&a.ops.pop(),a.trys.pop();continue}t=i.call(n,a)}catch(e){t=[6,e],o=0}finally{s=r=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}var c=(s.RES_TYPE_VIEW=0,s.RES_TYPE_SPRITE_FRAME=1,s.RES_TYPE_ATLAS=2,s.RES_TYPE_MP3=3,s.RES_TYPE_SPINE=4,s.RES_TYPE_JSON=5,s.RES_TYPE_ANIMATION=6,s.RES_TYPE_PREFAB=7,s.AGREEMENT_TYPE_REQUEST="request",s.AGREEMENT_TYPE_PUSH="push",s.AGREEMENT_TYPE_UDP="udp",s.SCREEN_STYLE_PORTRAIT=0,s.SCREEN_STYLE_LANDSCAPE=1,s.DEBUG_TYPE_0=0,s.DEBUG_TYPE_1=1,s.DEBUG_TYPE_2=2,s.DEBUG_LV_0=0,s.DEBUG_LV_1=1,s.DEBUG_LV_2=2,s);function s(){}var u=(o.version="",o.cacheKey="xxg",o.mainViewNum=1,o.logNum=20,o.netWarnTime=1500,o.debugType=0,o.debugLv=1,o.isOpenManyTouch=!1,o.screenStyle=0,o);function o(){}var r=(Object.defineProperty(l,"instance",{get:function(){return null==this._instance&&(this._instance=new l),this._instance},enumerable:!0,configurable:!0}),l.prototype.log=function(e){u.debugType!=c.DEBUG_TYPE_0&&(u.debugType==c.DEBUG_TYPE_1?cc.log(e):(this.list.push(e),this.send()))},l.prototype.error=function(e){u.debugType!=c.DEBUG_TYPE_0&&(u.debugType==c.DEBUG_TYPE_1?cc.error(e):(this.list.push("error："+e),this.send()))},l.prototype.coreLog=function(e){u.debugType!=c.DEBUG_TYPE_0&&(u.debugType==c.DEBUG_TYPE_1?cc.log("core"+e):(this.list.push(e),this.send()))},l.prototype.coreError=function(e){u.debugType!=c.DEBUG_TYPE_0&&(u.debugType==c.DEBUG_TYPE_1?cc.error("core"+e):(this.list.push("error："+e),this.send()))},l.prototype.send=function(){(u.debugType==c.DEBUG_TYPE_1||u.debugType==c.DEBUG_TYPE_2&&this.list.length>=u.logNum)&&(this.list=[])},l._instance=null,l);function l(){this.list=[]}function y(e){r.instance.coreError(e)}function h(e){r.instance.coreLog(e)}var p,d={ERROR_NO_LOCAL_MANIFEST:0,ERROR_DOWNLOAD_MANIFEST:1,NEW_VERSION_FOUND:2,ALREADY_UP_TO_DATE:3,UPDATE_PROGRESSION:4,ERROR_UPDATING:5,UPDATE_FINISHED:6,UPDATE_FAILED:7,ERROR_DECOMPRESS:8},f=cc._decorator,g=f.ccclass,m=f.property,b=f.menu,E=f.disallowMultiple,_=(t(N,p=cc.Component),N.prototype.onLoad=function(){cc.sys.isNative?(this.storagePath=(jsb.fileUtils?jsb.fileUtils.getWritablePath():"/")+"core-remote-asset",this.assetsManager=new jsb.AssetsManager("",this.storagePath,this.versionCompareHandle.bind(this)),this.assetsManager.setVerifyCallback(this.verifyCallBack.bind(this))):cc.log("core@HotUpdate：热更新组件只能在原生平台生效！")},N.prototype.setUrl=function(e){this.projectPath=(jsb.fileUtils?jsb.fileUtils.getWritablePath():"/")+"project.manifest";var t=this.getProjectJson();t.packageUrl=e,t.remoteManifestUrl=e+"project.manifest",t.remoteVersionUrl=e+"version.manifest",jsb.fileUtils.writeStringToFile(JSON.stringify(t),this.projectPath)},N.prototype.getBuildVersion=function(){return this.getProjectJson().version},N.prototype.checkCb=function(e){var t=null,n=null,i=null,s="",o="";switch(e.getEventCode()){case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:t=d.ERROR_NO_LOCAL_MANIFEST;break;case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:t=d.ERROR_DOWNLOAD_MANIFEST,i=e.getMessage();break;case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:t=d.ALREADY_UP_TO_DATE;break;case jsb.EventAssetsManager.NEW_VERSION_FOUND:if(this.assetsManager.getTotalBytes()<=0){h("@HotUpdate：检测到最新版本但是没有更新内容"),t=d.ALREADY_UP_TO_DATE;break}t=d.NEW_VERSION_FOUND,n=this.sizeConversion(this.assetsManager.getTotalBytes()),s=this.currentV,o=this.latestV}t&&(this.checkCallback&&this.checkCallback({state:t,size:n,msg:i,currentV:s,latestV:o}),this.assetsManager.setEventCallback(null),this.updating=!1)},N.prototype.checkUpdate=function(){var n=this;if(!this.updating)return new Promise(function(e){var t;if(n.project||e({state:d.ERROR_NO_LOCAL_MANIFEST,size:null,msg:"没有在编辑器中拖拽本地更新配置",currentV:"",latestV:""}),n.assetsManager.getState()===jsb.AssetsManager.State.UNINITED&&(t=n.projectPath?n.projectPath:n.project.nativeUrl,cc.loader.md5Pipe&&(t=cc.loader.md5Pipe.transformURL(t)),n.assetsManager.loadLocalManifest(t)),!n.assetsManager.getLocalManifest()||!n.assetsManager.getLocalManifest().isLoaded())return e({state:d.ERROR_NO_LOCAL_MANIFEST,size:null,msg:"找不到本地更新配置",currentV:"",latestV:""}),void(n.updating=!1);n.checkCallback=e,n.assetsManager.setEventCallback(n.checkCb.bind(n)),n.assetsManager.checkUpdate(),n.updating=!0})},N.prototype.hotUpdate=function(){var e;this.assetsManager&&!this.updating&&(this.assetsManager.setEventCallback(this.updateCb.bind(this)),this.assetsManager.getState()===jsb.AssetsManager.State.UNINITED&&(e=this.projectPath?this.projectPath:this.project.nativeUrl,cc.loader.md5Pipe&&(e=cc.loader.md5Pipe.transformURL(e)),this.assetsManager.loadLocalManifest(e)),this.assetsManager.update(),this.updating=!0)},N.prototype.updateCb=function(e){var t,n,i=!1,s=!1,o={state:null,percent:null,percentByFile:null,downloadedFiles:null,totalFiles:null,downloadedBytes:null,totalBytes:null,msg:null,assetId:null};switch(e.getEventCode()){case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:o.state=d.ERROR_NO_LOCAL_MANIFEST,o.msg="找不到本地更新配置，跳过热更新",s=!0;break;case jsb.EventAssetsManager.UPDATE_PROGRESSION:o.state=d.UPDATE_PROGRESSION,o.percent=e.getPercent(),o.percentByFile=e.getPercentByFile(),o.downloadedFiles=e.getDownloadedFiles(),o.totalFiles=e.getTotalFiles(),o.downloadedBytes=e.getTotalBytes();var r=e.getMessage();r&&(o.msg="更新文件："+r);break;case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:o.state=d.ERROR_DOWNLOAD_MANIFEST,o.msg="下载更新配置出错",s=!0;break;case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:o.state=d.ALREADY_UP_TO_DATE,o.msg="已经是最新版本",s=!0;break;case jsb.EventAssetsManager.UPDATE_FINISHED:o.state=d.UPDATE_FINISHED,o.msg="更新完成",i=!0;break;case jsb.EventAssetsManager.UPDATE_FAILED:o.state=d.UPDATE_FAILED,o.msg=e.getMessage(),this.updating=!1;break;case jsb.EventAssetsManager.ERROR_UPDATING:o.state=d.ERROR_UPDATING,o.assetId=e.getAssetId(),o.msg=e.getMessage();break;case jsb.EventAssetsManager.ERROR_DECOMPRESS:o.state=d.ERROR_DECOMPRESS,o.msg=e.getMessage()}this.updateCallback.emit([o]),s&&(this.assetsManager.setEventCallback(null),this.updating=!1),i&&(this.assetsManager.setEventCallback(null),t=jsb.fileUtils.getOriginalSearchPaths(),n=this.assetsManager.getLocalManifest().getSearchPaths(),Array.prototype.unshift.apply(t,n),cc.sys.localStorage.setItem("HotUpdateSearchPaths",JSON.stringify(t)),jsb.fileUtils.setSearchPaths(t),cc.audioEngine.stopAll(),cc.game.restart())},N.prototype.versionCompareHandle=function(e,t){h("@HotUpdate：检查是否需要更新 当前版本："+e+", 最新版本： "+t),this.currentV=e,this.latestV=t;for(var n=e.split("."),i=t.split("."),s=0;s<n.length;++s){var o=parseInt(n[s]),r=parseInt(i[s]||0);if(o!==r)return o-r}return i.length>n.length?-1:0},N.prototype.verifyCallBack=function(e,t){return t.compressed,t.md5,t.path,t.size,!0},N.prototype.sizeConversion=function(e){var t=e/8;if(t<=1024)return t.toFixed(0)+"B";var n=t/1024;if(n<=1024)return n.toFixed(0)+"KB";var i=n/1024;if(i<=1024)return i.toFixed(0)+"MB";var s=i/1024;return s<=1024?s.toFixed(0)+"GB":void 0},N.prototype.replaceUrl=function(e,t){var n=jsb.fileUtils.getStringFromFile(e);(n=JSON.parse(n)).packageUrl=t,n.remoteManifestUrl=t+"project.manifest",n.remoteVersionUrl=t+"version.manifest",jsb.fileUtils.writeStringToFile(JSON.stringify(n),e)},N.prototype.getProjectJson=function(){var e=null,t=jsb.fileUtils.getWritablePath()+"core-remote-asset";jsb.fileUtils.isDirectoryExist(t)&&jsb.fileUtils.getStringFromFile(t+"/project.manifest")&&(e=t+"/project.manifest"),e=e||this.project.nativeUrl,cc.loader.md5Pipe&&(e=cc.loader.md5Pipe.transformURL(e));var n=jsb.fileUtils.getStringFromFile(e);return JSON.parse(n)},n([m({type:cc.Asset})],N.prototype,"project",void 0),n([m(cc.Component.EventHandler)],N.prototype,"updateCallback",void 0),N=n([g("HotUpdate"),E(),b("核心库组件/热更新")],N));function N(){var e=p.call(this)||this;return e.assetsManager=null,e.storagePath="",e.updating=!1,e.project=null,e.checkCallback=null,e.updateCallback=new cc.Component.EventHandler,e.currentV=null,e.latestV=null,e.url=null,e.projectPath=null,e}var S=(L.timePoor=0,L.isGame=!1,L.isIos=!0,L.isAppPlatform=!1,L.isPcWebPlatform=!1,L.isMobile=!0,L.isNative=!1,L.isNet=!0,L.browser="",L.unitType="",L.baseLogicNum=0,L.nodeLogicNum=0,L);function L(){}var O=(Object.defineProperty(T,"instance",{get:function(){return null==this._instance&&(this._instance=new T),this._instance},enumerable:!0,configurable:!0}),T.prototype.init=function(){var e,t,n,i,s,o,r,a,c,u;S.isNative=cc.sys.isNative,cc.sys.isNative?cc.sys.OS_IOS==cc.sys.os?S.isIos=!0:cc.sys.OS_ANDROID==cc.sys.os&&(S.isIos=!1):(t=(e=navigator.userAgent.toLowerCase()).match(/iphone/i),n=e.match(/ipad/i),i=e.match(/ipod/i),s=e.match(/android/i),o=e.match(/mobile/i),r=e.match(/chrome/i),a=e.match(/mqqbrowser/i),c=e.match(/ucbrowser/),u=e.match(/safari/i),S.isMobile=!!o,t||n||i?S.isIos=!0:s&&(S.isIos=!1),r?S.browser="chrome":a?S.browser="qqBrowser":c?S.browser="ucBrowser":u&&(S.browser="safari")),this.judgeUnitType(),this.screenAdapter()},T.prototype.judgeUnitType=function(){var e=cc.find("Canvas"),t=e.width,n=e.height;u.screenStyle==c.SCREEN_STYLE_PORTRAIT?2<=n/t&&(S.unitType="Iphone X"):u.screenStyle==c.SCREEN_STYLE_LANDSCAPE&&2<=t/n&&(S.unitType="Iphone X")},T.prototype.screenAdapter=function(){"Iphone X"==S.unitType&&(u.screenStyle==c.SCREEN_STYLE_PORTRAIT?(this.leftOffsetPx=0,this.rightOffsetPx=0,this.onOffsetPx=50,this.downOffsetPx=50):u.screenStyle==c.SCREEN_STYLE_LANDSCAPE&&(this.leftOffsetPx=50,this.rightOffsetPx=50,this.onOffsetPx=0,this.downOffsetPx=0))},T.prototype.getOffset=function(){return{top:this.onOffsetPx,bottom:this.downOffsetPx,left:this.leftOffsetPx,right:this.rightOffsetPx}},T._instance=null,T);function T(){this.leftOffsetPx=0,this.rightOffsetPx=0,this.onOffsetPx=0,this.downOffsetPx=0}var C,R=cc._decorator,w=R.ccclass,M=(R.property,R.menu),I=R.disallowMultiple,P=R.requireComponent,A=(t(k,C=cc.Component),k.prototype.onLoad=function(){var e=this.node.getComponent(cc.Widget),t=O.instance.getOffset();e.top=t.top,e.bottom=t.bottom,e.left=t.left,e.right=t.right},k=n([w("ViewAdaptation"),I(),P(cc.Widget),M("核心库组件/界面适配")],k));function k(){return C.call(this)||this}var D=(V.prototype.watch=function(e,t){var n=("on_"+e+"_change").toUpperCase();return null==this.coreListeners[n]&&(this.coreListeners[n]={}),this.coreHandleIndex++,this.coreListeners[n][""+this.coreHandleIndex]=t,this.touch(e),this.coreHandleIndex},V.prototype.unwatch=function(e){var t=""+e;for(var n in this.coreListeners)if(this.coreListeners[n].hasOwnProperty(t))return void delete this.coreListeners[n][t]},V.prototype.touch=function(e,t,n){var i=("on_"+e+"_change").toUpperCase();if(t=t||this[e],n=n||this[e],null!=this.coreListeners[i])for(var s in this.coreListeners[i])(0,this.coreListeners[i][s])(t,n)},V);function V(){this.coreListeners={},this.coreHandleIndex=0}var U=(j.shineUpon=function(e){for(var t=e.key,n={},i=0,s=t.length;i<s;i++)n[t[i]]=i;return n},j.setTableData=function(e){this.table=e},j.getText=function(e){var t=this.table.lang[e];return t?t[this.shineUpon(this.table.lang).FieldContent]:"@"+e},j.table=null,j);function j(){}var F=(x.getCacheDataObj=function(){return{token:null,music:1,sound:1,userName:null}},x.getResDataObj=function(){return{name:null,type:null,path:null,obj:null}},x.getWsMessageObj=function(){return{uri:null,version:null,timestamp:null,attach:null,action:null,data:null}},x);function x(){}var B=(H.createNodeSprite=function(e,t,n,i){var s=i?new cc.Node(i):new cc.Node;return s.parent=n,s.addComponent(cc.Sprite).spriteFrame=e,s},H.createNodeLabel=function(e,t,n,i,s,o){var r=o?new cc.Node(o):new cc.Node;r.color=t,r.parent=s;var a=r.addComponent(cc.Label);return a.fontSize=n,a.lineHeight=i,a.string=e,a.horizontalAlign=cc.Label.HorizontalAlign.CENTER,a.verticalAlign=cc.Label.VerticalAlign.CENTER,r},H.bindButton=function(e,t,n,i){var s=e.addComponent(cc.Button);return i||(s.interactable=!0,s.enableAutoGrayEffect=!0,s.transition=cc.Button.Transition.SCALE,s.duration=.1,s.zoomScale=.9),s.node.on("click",t,n),s},H);function H(){}var q=(W.getCurrentTimeStamp=function(){return Math.floor((new Date).valueOf())-S.timePoor},W.goldFormatting=function(e){if(1e4<=e&&e<1e8){var t=(e/1e4).toFixed(3),n=t.indexOf(".");return t.substring(0,n+2+1)+U.getText("common007")}if(1e8<=e){var i=(e/1e8).toFixed(3),s=i.indexOf(".");return i.substring(0,s+2+1)+U.getText("common008")}return e.toFixed(2)},W.getYearMonthDay=function(e){var t=new Date(e);return t.getFullYear()+"-"+(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-"+(t.getDate()<10?"0"+t.getDate():t.getDate())},W.getWhenMinuteSecond=function(e){var t=new Date(e);return(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":"+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds())},W.secondToTime=function(e){var t="";if(3600<e)return h("@CommonFun：传入的最大值只支持3600秒以内"),null;var n=Math.floor(e/60);9<n?t+=n:n<1?(n=0,t+="00"):t+="0"+n,t+=":";var i=e-60*n;return t+=9<i?i:"0"+i},W.attributeCharacterFill=function(e,t){if(!e)return"";if(!e.length)return e;if(e){for(var n="",i=0;i<e.length;i++)"%"==e[i]&&0<=parseInt(e[i+1])&&parseInt(e[i+1])<=9?(n+=t[parseInt(e[i+1])],i++):n+=e[i];return n}},W.splitStringSemicolon=function(e){return e&&""!=e?e.split(":"):[]},W.splitStringComma=function(e){return e&&""!=e?(e=e.toString()).split(","):[]},W.splitStringSet=function(e){if(!e||""==e)return[];for(var t=W.splitStringComma(e),n=[],i=0,s=t.length;i<s;i++)n.push(W.splitStringSemicolon(t[i]));return n},W.setCacheData=function(e,t){localStorage.setItem(e,t)},W.getCacheData=function(e){return localStorage.getItem(e)},W.removeCacheData=function(e){return localStorage.removeItem(e)},W.cleanConnectionData=function(){var e=this.getCacheJsonData();e.token=null,W.setCacheJsonData(e)},W.getCacheJsonData=function(){var t,e=W.getCacheData(u.cacheKey);if(e&&"string"==typeof e)try{t=JSON.parse(e)}catch(e){t=F.getCacheDataObj(),W.setCacheData(u.cacheKey,JSON.stringify(t))}else t=F.getCacheDataObj(),W.setCacheData(u.cacheKey,JSON.stringify(t));return t},W.setCacheJsonData=function(e){this.setCacheData(u.cacheKey,JSON.stringify(e))},W.getUrlJumpData=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=location.search.substr(1).match(t);return null!=n?unescape(n[2]):null},W.binaryBitmapNum=function(e){for(var t=e.toString(),n="",i={0:"01",1:"23",2:"45",3:"67",4:"89",5:":;",6:"<=",7:">?",8:"@A",9:"BC",".":"D","+":"EF","-":"GH"},s=0;s<t.length;s++)n+=i[t[s]];return n},W.openViewAction=function(e,t){e.setScale(.5),e.runAction(cc.sequence(cc.scaleTo(.15,1),cc.callFunc(function(){t&&t()})))},W.vec2ToWordVec2=function(e,t){var n=null;t=t||cc.v2(0,0),n=e.convertToWorldSpaceAR(t);var i=cc.find("Canvas");return n.x=n.x-i.width/2,n.y=n.y-i.height/2,n},W.wordVec2ToVec2=function(e,t){t=t||cc.v2(0,0);var n=e.convertToNodeSpaceAR(t),i=cc.find("Canvas");return n.x=n.x+i.width/2,n.y=n.y+i.height/2,n},W.getRandom=function(e,t){if(t){var n=t-e;return Math.floor(Math.random()*n)+e}return Math.floor(Math.random()*e)},W.errPrompt=function(e){var t=cc.find("Canvas"),n=cc.color(255,0,0),i=B.createNodeLabel(e,n,24,30,t);i.runAction(cc.sequence(cc.delayTime(2),cc.callFunc(function(){i.destroy()})))},W.strToClipboard=function(e){var t=e+"",n=document.createElement("textarea");n.value=t,n.setAttribute("readonly",""),n.style.position="absolute",n.style.left="-9999px",n.style.fontSize="12pt";var i=getSelection(),s=null;0<i.rangeCount&&(s=i.getRangeAt(0)),document.body.appendChild(n),n.select(),n.selectionStart=0,n.selectionEnd=t.length;var o=!1;try{o=document.execCommand("copy")}catch(e){}return document.body.removeChild(n),s&&(i.removeAllRanges(),i.addRange(s)),o},W.getViewMainLogic=function(e){var t=e.name.replace("View","Logic");return e.getComponent(t)},W.getPrefabMainLogic=function(e){var t=e.name.replace("Component","Logic");return e.getComponent(t)},W.reboot=function(){cc.sys.isNative&&(cc.audioEngine.stopAll(),cc.game.restart())},W);function W(){}var Y=(Object.defineProperty(G,"instance",{get:function(){return null==this._instance&&(this._instance=new G),this._instance},enumerable:!0,configurable:!0}),G.prototype.onNetPush=function(e,t,n){this.descriptorOnNetPushMap[e]||(this.descriptorOnNetPushMap[e]=[]),this.descriptorOnNetPushMap[e].push({uri:t,funName:n})},G.prototype.getNetPushContrast=function(e){return this.descriptorOnNetPushMap[e]},G.prototype.onEvent=function(e,t,n){this.descriptorOnEventMap[e]||(this.descriptorOnEventMap[e]=[]),this.descriptorOnEventMap[e].push({eventName:t,funName:n})},G.prototype.getEventContrast=function(e){return this.descriptorOnEventMap[e]},G.prototype.onCode=function(e,t,n){this.descriptorOnCodeMap[e]||(this.descriptorOnCodeMap[e]=[]),this.descriptorOnCodeMap[e].push({code:t,funName:n})},G.prototype.getCodeContrast=function(e){return this.descriptorOnCodeMap[e]},G.prototype.onModule=function(e,t,n){this.descriptorOnModuleMap[e]||(this.descriptorOnModuleMap[e]=[]),this.descriptorOnModuleMap[e].push({obj:t,property:n})},G.prototype.getModuleContrast=function(e){return this.descriptorOnModuleMap[e]},G.prototype.onInstance=function(e,t,n){this.descriptorOnInstanceMap[e]||(this.descriptorOnInstanceMap[e]=[]),this.descriptorOnInstanceMap[e].push({class:t,property:n})},G.prototype.getInstanceContrast=function(e){return this.descriptorOnInstanceMap[e]},G._instance=null,G);function G(){this.descriptorOnNetPushMap={},this.descriptorOnEventMap={},this.descriptorOnCodeMap={},this.descriptorOnModuleMap={},this.descriptorOnInstanceMap={}}var J=0;function z(){return++J}var K=(Object.defineProperty(Q,"instance",{get:function(){return null==this._instance&&(this._instance=new Q),this._instance},enumerable:!0,configurable:!0}),Q.prototype.encode=function(e){var t,n,i,s,o,r,a,c="",u=0;for(e=this.utf8Encode(e);u<e.length;)s=(t=e.charCodeAt(u++))>>2,o=(3&t)<<4|(n=e.charCodeAt(u++))>>4,r=(15&n)<<2|(i=e.charCodeAt(u++))>>6,a=63&i,isNaN(n)?r=a=64:isNaN(i)&&(a=64),c=c+this.keyStr.charAt(s)+this.keyStr.charAt(o)+this.keyStr.charAt(r)+this.keyStr.charAt(a);return c},Q.prototype.decode=function(e){var t,n,i,s,o,r,a="",c=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<e.length;)t=this.keyStr.indexOf(e.charAt(c++))<<2|(s=this.keyStr.indexOf(e.charAt(c++)))>>4,n=(15&s)<<4|(o=this.keyStr.indexOf(e.charAt(c++)))>>2,i=(3&o)<<6|(r=this.keyStr.indexOf(e.charAt(c++))),a+=String.fromCharCode(t),64!=o&&(a+=String.fromCharCode(n)),64!=r&&(a+=String.fromCharCode(i));return a=this.utf8Decode(a)},Q.prototype.utf8Encode=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var i=e.charCodeAt(n);i<128?t+=String.fromCharCode(i):(127<i&&i<2048?t+=String.fromCharCode(i>>6|192):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128)),t+=String.fromCharCode(63&i|128))}return t},Q.prototype.utf8Decode=function(e){for(var t="",n=0,i=0,s=0,o=0;n<e.length;)(i=e.charCodeAt(n))<128?(t+=String.fromCharCode(i),n++):191<i&&i<224?(s=e.charCodeAt(n+1),t+=String.fromCharCode((31&i)<<6|63&s),n+=2):(s=e.charCodeAt(n+1),o=e.charCodeAt(n+2),t+=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o),n+=3);return t},Q._instance=null,Q);function Q(){this.keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}var X=(Z.getResObj=function(e){var t=this.coreResMap[e];if(!t)return null;var n=F.getResDataObj();return n.name=e,n.type=t.type,n.path=t.path,n},Z.getViewResList=function(e){var t=[],n=this.getViewResObj(e);t.push(n);var i=this.coreViewMap[e];if(i)for(var s=0;s<i.length;s++){var o=this.getResObj(i[s]);o?t.push(o):y("@CoreResList：\b\b\b视图<"+e+">内配置的资源<"+i[s]+">没有找到配置")}return t},Z.getViewResObj=function(e){var t=this.corePreloadControl[e];if(t){var n=F.getResDataObj();return n.name=e,n.path=t.path,n.type=c.RES_TYPE_VIEW,n}return null},Z.register=function(e,t,n,i){for(var s in e)this.corePreloadControl[s]=e[s];for(var o,s=0;s<t.length;s++){o=!0;for(var r=0;r<this.coreInitList.length;r++)t[s]==this.coreInitList[r]&&(o=!1);o&&this.coreInitList.push(t[s])}for(var s in n)this.coreViewMap[s]=n[s];for(var s in i)this.coreResMap[s]=i[s]},Z.corePreloadControl={},Z.coreInitList=[],Z.coreViewMap={},Z.coreResMap={config:{type:c.RES_TYPE_JSON,path:"Config/config"},table:{type:c.RES_TYPE_JSON,path:"Config/tableConfig"}},Z);function Z(){}var $=(Object.defineProperty(ee,"instance",{get:function(){return null==this._instance&&(this._instance=new ee),this._instance},enumerable:!0,configurable:!0}),ee.prototype.setCanvasDependAssets=function(){},ee.prototype.setInitRes=function(e){this.initResMap[e.name]=e},ee.prototype.removeInitRes=function(e){var t;this.initResMap[e]&&(t=this.initResMap[e],delete this.initResMap[e],this.releaseRes(t))},ee.prototype.getRes=function(i,s){return a(this,void 0,void 0,function(){var t,n;return v(this,function(e){switch(e.label){case 0:return(t=this.initResMap[i])?[2,t]:(t=this.resMap[s])&&t[i]?[2,t[i]]:(n=X.getResObj(i))?[4,this.loadRes(n)]:[3,2];case 1:return(n=e.sent())&&this.setRes(s,n),[2,n];case 2:return y("\b@ResManage\br：找不到资源名为<"+i+">的资源配置"),[2,null]}})})},ee.prototype.setRes=function(e,t){this.resMap[e]||(this.resMap[e]={}),this.resMap[e][t.name]=t},ee.prototype.releaseViewRes=function(e){var t=this.resMap[e];if(t){for(var n in t){var i=t[n];delete t[n],this.releaseRes(i)}delete this.resMap[e]}},ee.prototype.loadRes=function(i){return new Promise(function(n){var e=null;i.type==c.RES_TYPE_ATLAS?e=cc.SpriteAtlas:i.type==c.RES_TYPE_SPINE?e=sp.SkeletonData:i.type==c.RES_TYPE_ANIMATION?e=cc.AnimationClip:i.type==c.RES_TYPE_SPRITE_FRAME?e=cc.SpriteFrame:i.type==c.RES_TYPE_PREFAB&&(e=cc.Prefab),cc.resources.load(i.path,e,function(e,t,n){},function(e,t){e?(y("\b@ResManage\br：资源<"+i.name+">加载失败  "+e),n(null)):(i.obj=t,n(i))})})},ee.prototype.isRelease=function(e){if(this.initResMap[e])return!1;for(var t in this.resMap)if(this.resMap[t][e])return!1;return!0},ee.prototype.releaseRes=function(e){this.isRelease(e.name)&&cc.assetManager.releaseAsset(e.obj)},ee.prototype.logCacheRes=function(){console.log("@ResManager：初始化资源"),console.log(this.initResMap),console.log("@ResManager：缓存资源："),console.log(this.resMap)},ee.prototype.logCacheNum=function(){h("@ResManager：资源缓存数<"+cc.assetManager.assets.count+">")},ee.prototype.logCache=function(){console.log(cc.assetManager.assets._map)},ee._instance=null,ee);function ee(){this.initResMap={},this.resMap={}}var te=(Object.defineProperty(ne,"instance",{get:function(){return null==this._instance&&(this._instance=new ne),this._instance},enumerable:!0,configurable:!0}),ne.prototype.onDescriptor=function(e,t,n,i){for(var s=0;s<this.funNameList.length;s++)if(this.eventKeyList[s]==i&&t==this.thatList[s]&&n==this.instanceIdList[s])return y("\b@EventManage：相同方法不能多次注册！"),!1;return this.eventKeyList.push(e),this.funNameList.push(i),this.funList.push(null),this.thatList.push(t),this.instanceIdList.push(n),!0},ne.prototype.on=function(e,t,n){for(var i=0;i<this.funNameList.length;i++)if(n==this.thatList[i]&&t==this.funList[i])return void y("\b@EventManage：相同方法不能多次注册！");this.eventKeyList.push(e),this.funNameList.push(null),this.funList.push(t),this.thatList.push(n),this.instanceIdList.push(null)},ne.prototype.offDescriptor=function(e){for(var t=0;t<this.eventKeyList.length;t++)e==this.instanceIdList[t]&&(this.eventKeyList.splice(t,1),this.funNameList.splice(t,1),this.thatList.splice(t,1),this.instanceIdList.splice(t,1),this.funList.splice(t,1),t--)},ne.prototype.off=function(e,t){for(var n=0;n<this.eventKeyList.length;n++)e==this.eventKeyList[n]&&t==this.funList[n]&&null==this.instanceIdList[n]&&(this.eventKeyList.splice(n,1),this.funNameList.splice(n,1),this.thatList.splice(n,1),this.instanceIdList.splice(n,1),this.funList.splice(n,1),n--)},ne.prototype.event=function(e,t){for(var n=0;n<this.eventKeyList.length;n++)this.eventKeyList[n]==e&&(this.funList[n]?this.funList[n].call(this.thatList[n],t):this.thatList[n][this.funNameList[n]](t))},ne._instance=null,ne);function ne(){this.eventKeyList=[],this.funNameList=[],this.thatList=[],this.instanceIdList=[],this.funList=[]}var ie=(se.CORE_ON_HIDE="core_on_hide",se.CORE_ON_SHOW="core_on_show",se.CORE_NET_DISCONNECT="core_net_disconnect",se.CORE_NET_CONNECTION="core_net_connection",se.CORE_WS_DISCONNECT="core_ws_disconnect",se.CORE_WS_RECONNECTION_FAILUE="core_ws_reconnection_failue",se.CORE_WS_RECONNECTION_SUCCES="core_ws_reconnection_success",se.CORE_ON_DELAY_WARN="core_on_delayWarn",se.CORE_ON_CAPTURE_CODE="core_on_capture_code",se);function se(){}var oe=(re.CORE_ERROR_CODE_NONE=0,re.CORE_NO_URL=404,re.CORE_SERVER_ERROR=500,re.CORE_NOT_NET=801,re.CORE_WS_NOT_NET=802,re);function re(){}var ae=(ce.init=function(){this.protocol=window.xxgBuf},ce.isProtocol=function(){return!!this.protocol},ce.pack=function(e,t,n){var i,s=this.protocol[e].encode(t).finish(),o=this.charsToByte(e),r=o.length,a=this.tagLen+this.msgTypeLen+this.routeLen+this.serialNumLen+this.codeLen+this.secondTimeLen+this.millisecondTimeLen+this.nameLen+r+s.length,c=0,u=new Uint8Array(a);switch(u.set(this.numberToByte(this.protocolTag,this.tagLen),c),c+=this.tagLen,n){case"request":i=this.msgTypeRequest;break;case"udp":i=this.msgTypeUdp}return u.set(this.numberToByte(i,this.msgTypeLen),c),c+=this.msgTypeLen,u.set(this.numberToByte(this.route,this.routeLen),c),c+=this.routeLen,u.set(this.numberToByte(this.getSerialNum(),this.serialNumLen),c),c+=this.serialNumLen,u.set(this.numberToByte(0,this.codeLen),c),c+=this.codeLen,u.set(this.numberToByte(0,this.secondTimeLen),c),c+=this.secondTimeLen,u.set(this.numberToByte(0,this.millisecondTimeLen),c),c+=this.millisecondTimeLen,u.set(this.numberToByte(r,this.nameLen),c),c+=this.nameLen,u.set(o,c),c+=r,u.set(s,c),u},ce.unpack=function(e){var t=new Uint8Array(e),n=0,i=this.byteToNumber(t.subarray(n,this.tagLen),this.tagLen);if(n+=this.tagLen,i!=this.protocolTag)return null;var s,o=this.byteToNumber(t.subarray(n,n+this.msgTypeLen),this.msgTypeLen);switch(n+=this.msgTypeLen,o){case this.msgTypePush:s="push";break;case this.msgTypeRequest:s="request"}var r=this.byteToNumber(t.subarray(n,n+this.routeLen),this.routeLen);n+=this.routeLen,this.byteToNumber(t.subarray(n,n+this.serialNumLen),this.serialNumLen),n+=this.serialNumLen;var a=this.byteToNumber(t.subarray(n,n+this.codeLen),this.codeLen);n+=this.codeLen;var c=this.byteToNumber(t.subarray(n,n+this.secondTimeLen),this.secondTimeLen);n+=this.secondTimeLen;var u=this.byteToNumber(t.subarray(n,n+this.millisecondTimeLen),this.millisecondTimeLen);n+=this.millisecondTimeLen;var l=this.byteToNumber(t.subarray(n,n+this.nameLen),this.nameLen);n+=this.nameLen;var h=t.subarray(n,n+l);n+=l;var p=this.byteToString(h);this.route=r;var d=t.subarray(n),f=null;return a==oe.CORE_ERROR_CODE_NONE&&this.protocol[p]&&(f=this.protocol[p].decode(d,d.length)),{uri:p,data:f,action:s,code:a,timestamp:1e3*c+u}},ce.getSerialNum=function(){return this.curSerialNum>=this.serialNumMax&&(this.curSerialNum=1),this.curSerialNum++},ce.numberToByte=function(e,t){void 0===t&&(t=4);for(var n=new Uint8Array(t),i=0;i<t;i++)n[t-i-1]=e>>8*i&255;return n},ce.byteToNumber=function(e,t){void 0===t&&(t=4);for(var n=0,i=0;i<t;i++)n|=e[i]<<8*(t-i-1);return n},ce.charsToByte=function(e){for(var t=0,n=e.length,i=new Uint8Array(n);t<n;t++)i[t]=e.charCodeAt(t);return i},ce.byteToString=function(e){return String.fromCharCode.apply(null,e)},ce.route=0,ce.curSerialNum=1,ce.protocolTag=45,ce.protocol=null,ce.tagLen=1,ce.msgTypeLen=1,ce.routeLen=1,ce.serialNumLen=2,ce.serialNumMax=Math.pow(2,16)-1,ce.codeLen=2,ce.secondTimeLen=4,ce.millisecondTimeLen=4,ce.nameLen=1,ce.msgTypePush=0,ce.msgTypeRequest=1,ce.msgTypeUdp=2,ce);function ce(){}var ue,le=cc._decorator,he=le.ccclass,pe=le.property,de=le.menu,fe=le.disallowMultiple,ge=le.requireComponent,ve=(t(ye,ue=cc.Component),ye.prototype.onEnable=function(){var e=this;this.loadNode.active=!1,this.tag&&(this.timeout=setTimeout(function(){e.loadNode.active=!0,e.loadNode.runAction(cc.repeatForever(cc.rotateBy(1,360)))},500))},ye.prototype.onDisable=function(){clearTimeout(this.timeout),this.loadNode.active=!1,this.tag=!0},ye.prototype.setTag=function(e){this.tag=e},n([pe(cc.Node)],ye.prototype,"loadNode",void 0),ye=n([he("NetShield"),fe(),de("核心库组件/通讯屏蔽"),ge(cc.BlockInputEvents)],ye));function ye(){var e=ue.call(this)||this;return e.timeout=null,e.loadNode=null,e.tag=!0,e}var me,be=cc._decorator,Ee=be.ccclass,_e=be.property,Ne=be.menu,Se=be.disallowMultiple,Le=be.requireComponent,Oe=(t(Te,me=cc.Component),Te.prototype.onLoad=function(){this.mask.active=!1,this.skeleton.active=!1},Te.prototype.showLoadProgress=function(){this.lb.string="Load：0%",this.mask.active=!0,this.skeleton.active=!0},Te.prototype.setProgress=function(e,t){var n=this;e<0&&(e=0),100<e&&(e=100),this.interval&&clearInterval(this.interval),this.interval=setInterval(function(){n.progress>=e?clearInterval(n.interval):(n.progress++,n.showProgress(n.progress),100<=n.progress&&(t&&t(),clearInterval(n.interval),n.progress=0))},10)},Te.prototype.showProgress=function(e){this.lb.string="Load："+Math.ceil(e)+" %",100<=e&&(this.mask.active=!1,this.skeleton.active=!1,this.node.active=!1)},n([_e(cc.Node)],Te.prototype,"mask",void 0),n([_e(cc.Node)],Te.prototype,"skeleton",void 0),n([_e(cc.Label)],Te.prototype,"lb",void 0),Te=n([Ee("DistributedLoad"),Se(),Ne("核心库组件/分布式加载"),Le(cc.BlockInputEvents)],Te));function Te(){var e=me.call(this)||this;return e.mask=null,e.skeleton=null,e.lb=null,e.interval=null,e.progress=0,e}var Ce=(Object.defineProperty(Re,"instance",{get:function(){return null==this._instance&&(this._instance=new Re),this._instance},enumerable:!0,configurable:!0}),Re.prototype.setCanvasObj=function(e){this.canvas=e,this.shieldView=this.canvas.getChildByName("ShieldView"),this.shieldView.zIndex=9999,this.resLoadView=this.canvas.getChildByName("LoadView"),this.resLoadView.zIndex=9997,S.isNative&&(this.resLoadView.active=!1)},Re.prototype.getCanvasObj=function(){return this.canvas},Re.prototype.openShieldView=function(e){this.shieldView.getComponent(ve).setTag(e),this.shieldView.active=!0},Re.prototype.closeShieldView=function(){this.shieldView.active=!1},Re.prototype.openResLoadView=function(e){this.resLoadView.active=!0,S.isNative||e&&this.resLoadView.getComponent(Oe).showLoadProgress()},Re.prototype.closeResLoadView=function(){this.resLoadView.getComponent(Oe).showProgress(100)},Re.prototype.loadView=function(f,g){return a(this,void 0,void 0,function(){var t=this;return v(this,function(e){return[2,new Promise(function(d){return a(t,void 0,void 0,function(){var t,n,i,s,o,r,a,c,u,l,h,p=this;return v(this,function(e){switch(e.label){case 0:return t=!this.loadViewMap[f],n=this.resLoadView.getComponent(Oe),(i=X.getViewResObj(f))?[4,$.instance.loadRes(i)]:(y("找不到视图<"+f+">的相关配置！"),d(null),[2]);case 1:if(!(s=e.sent()).obj)return y("@ViewManage：加载<"+f+">视图失败！"),d(null),[2];if(o=cc.instantiate(s.obj),n.setProgress(20),r=s.name+"_"+S.nodeLogicNum++,$.instance.setRes(r,s),(a=q.getViewMainLogic(o)).coreSetNodeId(r),a.init(g),c=X.coreViewMap[o.name],S.isNative||!t)return d(o),[2];if(!(t&&c&&c.length))return[3,5];u=c.length,l=1,h=0,e.label=2;case 2:return h<c.length?[4,$.instance.getRes(c[h],r)]:[3,5];case 3:e.sent(),n.setProgress(l/u*78+20),l++,e.label=4;case 4:return h++,[3,2];case 5:return n.setProgress(100,function(){p.addLoadViewTag(f),d(o)}),[2]}})})})]})})},Re.prototype.addLoadViewTag=function(e){this.loadViewMap[e]=!0},Re.prototype.logViewLoadHistory=function(){h("@viewManage：已经加载过的视图："+JSON.stringify(this.loadViewMap))},Re.prototype.openView=function(s,o,r){return a(this,void 0,void 0,function(){var t,n,i;return v(this,function(e){switch(e.label){case 0:return t=(new Date).getTime(),n=!this.loadViewMap[s],S.isGame&&!S.isNative&&this.openResLoadView(n),[4,this.loadView(s,o)];case 1:return(i=e.sent())?(i.zIndex=r||this.zIndex,this.canvas.addChild(i),S.isGame&&this.closeResLoadView(),this.zIndex++,this.pushNode(i,r),this.retrieveView(),h("@ViewManager：打开视图<"+i.name+"> 耗时<"+((new Date).getTime()-t)+">毫秒"),$.instance.logCacheNum(),[2,!0]):(this.closeResLoadView(),[2,!1])}})})},Re.prototype.closeView=function(e){var t;if(e){for(var n=void 0,i=null,n=this.viewNameStack.length-1;0<=n;n--)if(this.viewNameStack[n]==e){i=n;break}if(null==i)return void y("@ViewManage：当前打开的视图堆栈中没有<"+e+">视图");this.closeRetrieveView(i),t=this.viewStack[i],this.viewStack.splice(i,1),this.viewNameStack.splice(i,1),this.topPointer--}else if(this.closeRetrieveView(this.topPointer-1),!(t=this.popNode()))return void y("@ViewManage：视图堆栈中没有视图");t&&(this.zIndex--,t.destroy(),h("@ViewManager：关闭视图"+t.name),$.instance.logCacheNum(),cc.sys.garbageCollect())},Re.prototype.getChildViewObj=function(e){return this.canvas.getChildByName(e)},Re.prototype.getScriptObj=function(e,t){var n=this.getChildViewObj(e);if(n){var i=n.getComponent(t);if(i)return i;y("@ViewManage：找不到<"+t+">脚本！")}else y("@ViewManage：找不到<"+e+">视图！")},Re.prototype.goToMainView=function(){for(;this.topPointer>u.mainViewNum;)this.closeView()},Re.prototype.retrieveView=function(){if(1<this.topPointer){var e=this.topPointer-1,t=this.getTagToViewStyle(e),n=void 0,i=void 0;if(0==t)return;if(1==t)for(n=e-1;0<=n;n--)(i=this.viewStack[n]).active&&(i.active=!1)}},Re.prototype.closeRetrieveView=function(e){if(!(e<=0))if(e+1==this.topPointer){--e,(i=this.viewStack[e]).active=!0;for(var t=void 0,n=e;0<n;n--)if(0==(t=this.getTagToViewStyle(n)))(i=this.viewStack[n-1])&&i.isValid&&0==i.active&&(i.active=!0);else if(1==t)return}else{var n=void 0,t=void 0,i=void 0;for(n=this.topPointer-1;0<=n;n--)if(1==(t=this.getTagToViewStyle(n)))(i=this.viewStack[n-1])&&i.isValid&&0==i.active&&(i.active=!0);else if(1==t)return}},Re.prototype.getTagToViewStyle=function(e){var t=this.viewStack[e];return q.getViewMainLogic(t).style},Re.prototype.pushNode=function(e,t){if(e.active=!0,t){for(var n=this.viewStack.length-1;t<=n;n--)this.viewNameStack[n+1]=this.viewNameStack[n],this.viewStack[n].zIndex++,this.viewStack[n+1]=this.viewStack[n];this.viewNameStack[t]=e.name,this.viewStack[t]=e}else this.viewNameStack.push(e.name),this.viewStack.push(e);this.topPointer++},Re.prototype.popNode=function(){if(this.topPointer){var e=this.topPointer-1;this.closeRetrieveView(e);var t=this.viewStack[e];return t.destroy(),this.viewStack.splice(e,1),this.viewNameStack.splice(e,1),this.topPointer--,t}},Re._instance=null,Re);function Re(){this.viewStack=[],this.viewNameStack=[],this.topPointer=0,this.zIndex=0,this.loadViewMap={},this.isOpenSystemPopupWindow=!1}var we=(Object.defineProperty(Me,"instance",{get:function(){return null==this._instance&&(this._instance=new Me),this._instance},enumerable:!0,configurable:!0}),Me.prototype.registerMusicManage=function(){this.cacheData=q.getCacheJsonData(),this.musicNum=this.cacheData.music,this.soundNum=this.cacheData.sound,this.setAllMusicVolume(this.cacheData.music),this.setAllSoundVolume(this.cacheData.sound)},Me.prototype.setAllMusicVolume=function(e){this.musicNum=e,cc.audioEngine.setMusicVolume(e),this.updateCacheData()},Me.prototype.setAllSoundVolume=function(e){this.soundNum=e,cc.audioEngine.setEffectsVolume(e),this.updateCacheData()},Me.prototype.setAllMute=function(){this.muteMusic=cc.audioEngine.getMusicVolume(),this.muteSound=cc.audioEngine.getEffectsVolume(),cc.audioEngine.setMusicVolume(0),cc.audioEngine.setEffectsVolume(0),this.isMute=!0},Me.prototype.setAllNoMute=function(){this.isMute&&(cc.audioEngine.setMusicVolume(this.muteMusic),cc.audioEngine.setEffectsVolume(this.muteSound)),this.isMute=!1},Me.prototype.playMusic=function(e){cc.audioEngine.playMusic(e,!0)},Me.prototype.playSound=function(e){this.soundNum&&cc.audioEngine.playEffect(e,!1)},Me.prototype.getMusicNum=function(){return this.musicNum},Me.prototype.getSoundNum=function(){return this.soundNum},Me.prototype.updateCacheData=function(){this.cacheData.music=this.musicNum,this.cacheData.sound=this.soundNum,q.setCacheJsonData(this.cacheData)},Me._instance=null,Me);function Me(){this.isMute=!1,this.muteMusic=null,this.muteSound=null}var Ie,Pe=(t(Ae,Ie=cc.Component),Ae.prototype.onLoad=function(){return a(this,void 0,void 0,function(){return v(this,function(e){switch(e.label){case 0:return console.log("前端框架版本：3.0.20"),this.init(),[4,this.loadApplication()];case 1:return e.sent()?[4,this.preload()]:(h("@ApplicationLogic：项目启动被阻断"),[2]);case 2:return e.sent(),[4,this.startApplication()];case 3:return e.sent(),this.setLoadProgress(100),[2]}})})},Ae.prototype.coreRegisterRes=function(e){var t=new e;X.register(t.preloadControl,t.initList,t.viewMap,t.resMap)},Ae.prototype.coreRegisterConfig=function(e){for(var t in e)u[t]=e[t]},Ae.prototype.init=function(){cc.game.on(cc.game.EVENT_HIDE,function(){te.instance.event(ie.CORE_ON_HIDE)}),cc.game.on(cc.game.EVENT_SHOW,function(){te.instance.event(ie.CORE_ON_SHOW)}),cc.sys.isNative||(window.addEventListener("offline",function(){S.isNet=!1,te.instance.event(ie.CORE_NET_DISCONNECT)}),window.addEventListener("online",function(){S.isNet=!0,te.instance.event(ie.CORE_NET_CONNECTION)})),cc.macro.ENABLE_MULTI_TOUCH=u.isOpenManyTouch,ae.init(),O.instance.init(),Ce.instance.setCanvasObj(cc.find("Canvas")),we.instance.registerMusicManage()},Ae.prototype.preload=function(){return a(this,void 0,void 0,function(){var t,n,i,s;return v(this,function(e){switch(e.label){case 0:if($.instance.logCacheNum(),!X.coreInitList)return[3,4];i=void 0,n=X.coreInitList.length,s=0,e.label=1;case 1:return s<n?[4,$.instance.loadRes(X.getResObj(X.coreInitList[s]))]:[3,4];case 2:i=e.sent(),$.instance.setInitRes(i),this.setLoadProgress(parseInt((40*(s+1)/n).toFixed(0))),e.label=3;case 3:return s++,[3,1];case 4:if(!X.corePreloadControl)return[3,8];for(s in t=[],X.corePreloadControl)X.corePreloadControl[s].isLoad&&(t=t.concat(X.getViewResList(s)));n=t.length,i=void 0,s=0,e.label=5;case 5:return s<n?[4,$.instance.loadRes(t[s])]:[3,8];case 6:(i=e.sent()).type==c.RES_TYPE_VIEW&&Ce.instance.addLoadViewTag(i.name),$.instance.releaseRes(i),this.setLoadProgress(40+parseInt((50*(s+1)/n).toFixed(0))),e.label=7;case 7:return s++,[3,5];case 8:return $.instance.logCacheNum(),[2]}})})},Ae.prototype.loadApplication=function(){return a(this,void 0,void 0,function(){return v(this,function(e){return[2,!0]})})},Ae.prototype.startApplication=function(){return null},Ae.prototype.setLoadProgress=function(e){e<0&&(e=0),100<=e&&(e=100,S.isGame=!0),this.initLoadProgress(e)},Ae.prototype.initLoadProgress=function(e){},Ae);function Ae(){var e=Ie.call(this)||this;return e.httpUrl=null,e.token=null,e}var ke=(Object.defineProperty(De,"instance",{get:function(){return null==this._instance&&(this._instance=new De),this._instance},enumerable:!0,configurable:!0}),De.prototype.setPushData=function(e,t){this.messageDistribute(e,t)},De.prototype.messageDistribute=function(e,t){for(var n=0;n<this.uriList.length;n++)this.uriList[n]==e&&this.thatList[n][this.funNameList[n]](t)},De.prototype.on=function(e,t,n,i){for(var s=0;s<this.funNameList.length;s++)if(this.uriList[s]==i&&t==this.thatList[s]&&n==this.instanceIdList[s])return y("\b@NetPushManager：相同方法不能多次注册！"),!1;return this.uriList.push(e),this.funNameList.push(i),this.thatList.push(t),this.instanceIdList.push(n),!0},De.prototype.off=function(e){for(var t=0;t<this.uriList.length;t++)e==this.instanceIdList[t]&&(this.uriList.splice(t,1),this.funNameList.splice(t,1),this.thatList.splice(t,1),this.instanceIdList.splice(t,1),t--)},De._instance=null,De);function De(){this.uriList=[],this.funNameList=[],this.thatList=[],this.instanceIdList=[]}var Ve=(Object.defineProperty(Ue,"instance",{get:function(){return null==this._instance&&(this._instance=new Ue),this._instance},enumerable:!0,configurable:!0}),Ue.prototype.checkCode=function(e){this.codeDistribute(e)},Ue.prototype.codeDistribute=function(e){for(var t=!0,n=0;n<this.codeList.length;n++)this.codeList[n]==e&&(this.thatList[n][this.funNameList[n]](e),t=!1);t&&te.instance.event(ie.CORE_ON_CAPTURE_CODE,e)},Ue.prototype.on=function(e,t,n,i){return this.codeList.push(e),this.funNameList.push(i),this.thatList.push(t),this.instanceIdList.push(n),!0},Ue.prototype.off=function(e){for(var t=0;t<this.codeList.length;t++)e==this.instanceIdList[t]&&(this.codeList.splice(t,1),this.funNameList.splice(t,1),this.thatList.splice(t,1),this.instanceIdList.splice(t,1),t--)},Ue._instance=null,Ue);function Ue(){this.codeList=[],this.funNameList=[],this.thatList=[],this.instanceIdList=[]}var je=(Fe.prototype.setTimeout=function(t){var n=this,i=null,e=new Promise(function(e){i=setTimeout(function(){e(),n.clearTimeout(i)},t),n.timeOutList.push(i)});return{id:i,promise:e}},Fe.prototype.clearTimeout=function(e){for(var t=0;t<this.timeOutList.length;t++)if(e==this.timeOutList[t])return clearTimeout(e),void this.timeOutList.splice(t,1)},Fe.prototype.setInterval=function(e,t){var n=setInterval(function(){e()},t);return this.intervalList.push(n),n},Fe.prototype.clearInterval=function(e){for(var t=0;t<this.intervalList.length;t++)if(e==this.intervalList[t])return clearInterval(e),void this.intervalList.splice(t,1)},Fe.prototype.clearAll=function(){for(var e=0;e<this.timeOutList.length;e++)clearTimeout(this.timeOutList[e]);for(this.timeOutList=[],e=0;e<this.intervalList.length;e++)clearInterval(this.intervalList[e]);this.intervalList=[]},Fe);function Fe(){this.timeOutList=[],this.intervalList=[]}var xe=(Be.prototype.coreOnPushFun=function(){var e=this.__proto__.classId;if(e){var t=Y.instance.getNetPushContrast(e);if(t)for(var n=0;n<t.length;n++)ke.instance.on(t[n].uri,this,this.coreInstanceId,t[n].funName)}},Be.prototype.coreOnCodeFun=function(){var e=this.__proto__.classId;if(e){var t=Y.instance.getCodeContrast(e);if(t)for(var n=0;n<t.length;n++)Ve.instance.on(t[n].code,this,this.coreInstanceId,t[n].funName)}},Be.prototype.coreOnEventFun=function(){var e=this.__proto__.classId;if(e){var t=Y.instance.getEventContrast(e);if(t)for(var n=0;n<t.length;n++)te.instance.onDescriptor(t[n].eventName,this,this.coreInstanceId,t[n].funName)}},Be.prototype.coreOnModule=function(){var e=this.__proto__.classId;if(e){var t=Y.instance.getModuleContrast(e);if(t)for(var n=0;n<t.length;n++)t[n].obj==je&&(this.coreTimerModule=new je,this[t[n].property]=this.coreTimerModule)}},Be.prototype.coreGetInstanceId=function(){return this.coreInstanceId},Be.prototype.destructor=function(){te.instance.offDescriptor(this.coreInstanceId),ke.instance.off(this.coreInstanceId),Ve.instance.off(this.coreInstanceId),this.coreTimerModule&&this.coreTimerModule.clearAll(),this.coreDestructor()},Be.prototype.coreDestructor=function(){},Be);function Be(){this.coreInstanceId="baseLogic",this.coreTimerModule=null,this.coreInstanceId+="_"+S.baseLogicNum++,this.coreOnPushFun(),this.coreOnEventFun(),this.coreOnCodeFun(),this.coreOnModule()}var He=(qe.prototype.setAllMusicVolume=function(e){e<0||1<e?y("@Audio：音量取值范围0~1"):we.instance.setAllMusicVolume(e)},qe.prototype.setAllSoundVolume=function(e){e<0||1<e?y("@Audio：音效取值范围0~1"):we.instance.setAllSoundVolume(e)},qe.prototype.setAllMute=function(){we.instance.setAllMute()},qe.prototype.setAllNoMute=function(){we.instance.setAllNoMute()},qe.prototype.playMusic=function(i){return a(this,void 0,void 0,function(){var t,n;return v(this,function(e){switch(e.label){case 0:return t=null,"string"!=typeof i?[3,2]:[4,$.instance.getRes(i,this.coreViewId)];case 1:return(n=e.sent())&&n.obj?(t=n.obj,[3,3]):[2,!1];case 2:t=i,e.label=3;case 3:return we.instance.playMusic(t),[2,!0]}})})},qe.prototype.playSound=function(i){return a(this,void 0,void 0,function(){var t,n;return v(this,function(e){switch(e.label){case 0:return t=null,"string"!=typeof i?[3,2]:[4,$.instance.getRes(i,this.coreViewId)];case 1:return(n=e.sent())&&n.obj?(t=n.obj,[3,3]):[2,!1];case 2:t=i,e.label=3;case 3:return we.instance.playSound(t),[2,!0]}})})},qe.prototype.getMusicNum=function(){return we.instance.getMusicNum()},qe.prototype.getSoundNum=function(){return we.instance.getSoundNum()},qe.prototype.updateCacheData=function(){we.instance.updateCacheData()},qe);function qe(e){this.coreViewId=e}var We=(Ye.prototype.getRes=function(e){return $.instance.getRes(e,this.coreViewId)},Ye.prototype.getPrefab=function(s){return a(this,void 0,void 0,function(){var t,n,i;return v(this,function(e){switch(e.label){case 0:return(t=X.getResObj(s)).type!=c.RES_TYPE_PREFAB?(y("@Res：加载的资源不是Prefab"),[2,null]):[4,$.instance.loadRes(t)];case 1:return(t=e.sent()).obj?(n=cc.instantiate(t.obj),i=n.name+"_"+S.nodeLogicNum++,$.instance.setRes(i,t),q.getPrefabMainLogic(n).coreSetNodeId(i),[2,n]):(y("@Res：加载<"+s+">Prefab失败！"),[2,null])}})})},Ye.prototype.loadExternal=function(i){return new Promise(function(n){cc.assetManager.loadRemote(i,function(e,t){e&&(y("@ResManage：外部资源加载错误"+i),y(e)),n(t)})})},Ye);function Ye(e){this.coreViewId=e}var Ge=(Je.prototype.play=function(h,p,d){return a(this,void 0,void 0,function(){var t,n,i,s,o,r,a,c,u,l;return v(this,function(e){switch(e.label){case 0:return[4,$.instance.getRes(h,this.coreViewId)];case 1:if(t=e.sent(),n=new cc.Node,(i=n.addComponent(sp.Skeleton)).skeletonData=t.obj,i.loop=d&&d.isLoop,i.premultipliedAlpha=!1,u=c=a=r=o=s=null,d&&(d&&d.startCallback&&(s=d.startCallback),d&&d.interruptCallback&&(o=d.interruptCallback),d&&d.endCallback&&(r=d.endCallback),d&&d.disposeCallback&&(a=d.disposeCallback),d&&d.completeCallback&&(c=d.completeCallback),d&&d.eventCallback&&(u=d.eventCallback)),d&&d.vec2&&(n.x=d.vec2.x,n.y=d.vec2.y),d&&d.name&&(i.animation=d.name),i.setStartListener(function(){s&&s(i)}),i.setInterruptListener(function(){o&&o(i)}),i.setEndListener(function(){r&&r(i)}),i.setDisposeListener(function(){a&&a(i)}),i.setCompleteListener(function(){c&&c(i)}),i.setEventListener(function(){u&&u(i)}),p&&n&&p.addChild(n),d&&d.loadOver&&d.loadOver(n,i),d&&d.playList&&d.playList.length)for(l=0;l<d.playList.length;l++)i.addAnimation(l+1,d.playList[l].name,d.playList[l].isLoop);return[2,n]}})})},Je.prototype.playBinNode=function(e,t){e.name=t.name,e.loop=t&&t.isLoop,e.premultipliedAlpha=!1;var n=null,i=null,s=null,o=null,r=null,a=null;if(t&&(t&&t.startCallback&&(n=t.startCallback),t&&t.interruptCallback&&(i=t.interruptCallback),t&&t.endCallback&&(s=t.endCallback),t&&t.disposeCallback&&(o=t.disposeCallback),t&&t.completeCallback&&(r=t.completeCallback),t&&t.eventCallback&&(a=t.eventCallback)),t&&t.name&&(e.animation=t.name),e.setStartListener(function(){n&&n(e)}),e.setInterruptListener(function(){i&&i(e)}),e.setEndListener(function(){s&&s(e)}),e.setDisposeListener(function(){o&&o(e)}),e.setCompleteListener(function(){r&&r(e)}),e.setEventListener(function(){a&&a(e)}),t&&t.playList&&t.playList.length)for(var c=0;c<t.playList.length;c++)e.addAnimation(c+1,t.playList[c].name,t.playList[c].isLoop)},Je);function Je(e){this.coreViewId=e}var ze,Ke=(t(Qe,ze=cc.Component),Qe.prototype.coreOnEventFun=function(){var e=this.__proto__.classId;if(e){var t=Y.instance.getEventContrast(e);if(t)for(var n=0;n<t.length;n++)te.instance.onDescriptor(t[n].eventName,this,this.coreNodeId,t[n].funName)}},Qe.prototype.coreOnModule=function(){var e=this.__proto__.classId;if(e){var t=Y.instance.getModuleContrast(e);if(t)for(var n=0;n<t.length;n++)t[n].obj==He?this[t[n].property]=new He(this.coreNodeId):t[n].obj==We?this[t[n].property]=new We(this.coreNodeId):t[n].obj==je?(this.coreTimerModule=new je,this[t[n].property]=this.coreTimerModule):t[n].obj==Ge?this[t[n].property]=new Ge(this.coreNodeId):(y("@ComponentLogic：注册的模块无法识别"),h(t[n].obj))}},Qe.prototype.coreOnPushFun=function(){var e=this.__proto__.classId;if(e){var t=Y.instance.getNetPushContrast(e);if(t)for(var n=0;n<t.length;n++)ke.instance.on(t[n].uri,this,this.coreNodeId,t[n].funName)}},Qe.prototype.coreOnCodeFun=function(){var e=this.__proto__.classId;if(e){var t=Y.instance.getCodeContrast(e);if(t)for(var n=0;n<t.length;n++)Ve.instance.on(t[n].code,this,this.coreNodeId,t[n].funName)}},Qe.prototype.coreOnInstance=function(){var e=this.__proto__.classId;if(e){var t=Y.instance.getInstanceContrast(e);if(t)for(var n=0;n<t.length;n++){var i=new t[n].class;i.destructor&&i.coreGetInstanceId?(this[t[n].property]=i,this.coreInstanceList.push(i)):y("@ComponentLogic：注册的实例没有继承于Core.BaseLogic")}}},Qe.prototype.coreOnModel=function(e,t,n){var i=e.watch(t,n),s=this.coreGetModelHandle(e);return s||(s={model:e,watchHandles:[]},this.coreMdHandles.push(s)),s.watchHandles.push(i),i},Qe.prototype.coreGetModelHandle=function(e){for(var t=this.coreMdHandles.length,n=0;n<t;n++){var i=this.coreMdHandles[n];if(i.model===e)return i}return null},Qe.prototype.coreOnLoad=function(){},Qe.prototype.coreStart=function(){},Qe.prototype.coreUpdate=function(e){},Qe.prototype.coreLateUpdate=function(){},Qe.prototype.coreOnEnable=function(){},Qe.prototype.coreOnDisable=function(){},Qe.prototype.coreOnDestroy=function(){},Qe.prototype.coreSetNodeId=function(e){this.coreNodeId=e},Qe.prototype.coreGetNodeId=function(){return this.coreNodeId},Qe.prototype.onLoad=function(){null==this.coreNodeId&&(this.coreNodeId=this.node.name+"_"+S.nodeLogicNum++),this.coreOnEventFun(),this.coreOnModule(),this.coreOnInstance(),this.coreOnCodeFun(),this.coreOnPushFun(),this.coreOnLoad()},Qe.prototype.start=function(){this.coreStart()},Qe.prototype.update=function(e){this.coreUpdate(e)},Qe.prototype.lateUpdate=function(){this.coreLateUpdate()},Qe.prototype.onDestroy=function(){this.coreTimerModule&&this.coreTimerModule.clearAll();for(var e=0;e<this.coreInstanceList.length;e++)this.coreInstanceList[e].destructor&&(this.coreInstanceList[e].destructor(),this.coreInstanceList[e]=null);te.instance.offDescriptor(this.coreNodeId),ke.instance.off(this.coreNodeId),Ve.instance.off(this.coreNodeId);for(var t=null,n=[],e=0;e<this.coreMdHandles.length;e++)if(t=this.coreMdHandles[e].model){n=this.coreMdHandles[e].watchHandles;for(var i=0;i<n.length;i++)t.unwatch(n[i])}this.coreOnDestroy(),$.instance.releaseViewRes(this.coreNodeId)},Qe.prototype.onEnable=function(){this.coreOnEnable()},Qe.prototype.onDisable=function(){this.coreOnDisable()},Qe);function Qe(){var e=ze.call(this)||this;return e.coreNodeId=null,e.coreTimerModule=null,e.coreMdHandles=[],e.coreInstanceList=[],e}var Xe,Ze=(t($e,Xe=Ke),$e.prototype.coreOpenViewShield=function(){this.node.on(cc.Node.EventType.TOUCH_END,this.coreShieldTouchCallBack,this)},$e.prototype.coreCloseViewShield=function(){this.node.off(cc.Node.EventType.TOUCH_END,this.coreShieldTouchCallBack,this)},$e.prototype.coreShieldTouchCallBack=function(e){},$e.prototype.init=function(e){},$e.prototype.coreCloseView=function(){Ce.instance.closeView(this.node.name)},$e);function $e(){var e=Xe.call(this)||this;return e.style=0,e}var et=(Object.defineProperty(tt,"instance",{get:function(){return null==this._instance&&(this._instance=new tt),this._instance},enumerable:!0,configurable:!0}),tt.prototype.setUrl=function(e){this.url=e},tt.prototype.send=function(e,t,o){var r=this;return new Promise(function(n,i){if(!r.url)return y("@HttpRequest：没有设置HTTP请求的根地址"),void i();var s=new XMLHttpRequest;if(s.onreadystatechange=function(){if(4==s.readyState){if(clearTimeout(r.timeoutId),Ce.instance.closeShieldView(),200==s.status){var e=void 0;try{e=JSON.parse(s.responseText)}catch(e){return y("@HttpRequest：收到的后端数据不是json格式 "+s.responseText),void i()}u.debugType==c.DEBUG_TYPE_1?S.isNative?cc.log("http <== ",JSON.stringify(e)):cc.log("http %c <== ","color:green;background-color:rgba(167, 167, 167, 0.2)",e):h("@HttpRequest：服务器返回数据 "+s.responseText);var t=parseInt(e.code);if(t==oe.CORE_ERROR_CODE_NONE)return void n(e.data);Ve.instance.checkCode(t)}else{if(0==s.status)return void Ve.instance.checkCode(oe.CORE_NOT_NET);Ve.instance.checkCode(s.status)}i()}},"GET"==o)s.open(o,r.url+t+"?"+e,!0),s.setRequestHeader("Content-Type","application/json;charset=UTF-8"),s.send(),u.debugType==c.DEBUG_TYPE_1?cc.log("http get %c ==> ","color:red;background-color:rgba(167, 167, 167, 0.2)",r.url+t+"?"+e):h("@HttpRequest：发送GET请求 "+r.url+t+"?"+e);else{if("POST"!=o)return y("@HttpRequest：HTTP请求传入的请求类型错误！请检查！（请传入 GET 或者 POST）"),void i();s.open(o,r.url+t,!0),s.setRequestHeader("Content-Type","application/json;charset=UTF-8"),s.send(e),u.debugType==c.DEBUG_TYPE_1?S.isNative?cc.log("http ==> ",e):(cc.log("http post %c ==> ","color:red;background-color:rgba(167, 167, 167, 0.2)",r.url+t),cc.log(JSON.parse(e))):h("@HttpRequest：发送POST请求 "+r.url+t+" "+e)}Ce.instance.openShieldView(),r.timeoutId=setTimeout(function(){Ce.instance.closeShieldView(),y("@HttpRequest：http请求超时"),i()},5e3)})},tt.prototype.loadJS=function(n){return new Promise(function(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4==t.readyState){if(200<=t.status&&t.status<=207||0==t.status)return void e(t.responseText);e(null)}},t.open("GET",n,!0),t.send()})},tt._instance=null,tt);function tt(){this.timeoutId=null,this.url=null}var nt=(Object.defineProperty(it,"instance",{get:function(){return null==this._instance&&(this._instance=new it),this._instance},enumerable:!0,configurable:!0}),it.prototype.send=function(n,i){var s=this;if(cc.sys.isNative)return new Promise(function(e){var t={uri:n.uri,data:n.data,action:"request",outTime:i,callback:e};s.request=t,s.upMessage(t)});y("@ShellRequest：外壳交互需要在Native环境中进行")},it.prototype.upMessage=function(e){var t=this;this.logSend({uri:e.uri,data:e.data,action:"request"}),e.outTime&&0<e.outTime&&(this.outTimeId=setTimeout(function(){h("@ShellRequest：发生协议超时情况（"+e.uri+"）"),t.downMessage(e.uri,null),clearTimeout(t.outTimeId),t.outTimeId=null},e.outTime)),cc.sys.isNative&&(cc.sys.OS_IOS==cc.sys.os?jsb.reflection.callStaticMethod("XXGBridge","send:",JSON.stringify(e)):cc.sys.OS_ANDROID==cc.sys.os&&jsb.reflection.callStaticMethod("org/cocos2dx/javascript/xxg/XXGBridge","Send","(Ljava/lang/String;)V",JSON.stringify(e)))},it.prototype.receive=function(e){var t=e.uri,n=e.action;this.logReceive(e),this.outTimeId&&(clearTimeout(this.outTimeId),this.outTimeId=null),t||y("@ShellRequest：收到的协议没有uri协议标识"),n||y("@ShellRequest：收到的协议没有action行为"),n==c.AGREEMENT_TYPE_PUSH?ke.instance.setPushData(t,e.data):n==c.AGREEMENT_TYPE_REQUEST&&this.downMessage(t,e.data)},it.prototype.downMessage=function(e,t){this.request&&(this.request.uri=e)&&this.request.callback&&(this.request.callback(t),this.request=null)},it.prototype.logSend=function(e){u.debugType==c.DEBUG_TYPE_1?S.isNative&&cc.log("ShellRequest ==> ",JSON.stringify(e)):h("@ShellRequest：发送消息 "+JSON.stringify(e))},it.prototype.logReceive=function(e){u.debugType==c.DEBUG_TYPE_1?S.isNative&&cc.log("ShellRequest <== ",JSON.stringify(e)):h("@ShellRequest：收到消息 "+JSON.stringify(e))},it._instance=null,it);function it(){var t=this;this.request=null,this.outTimeId=null,cc.sys.isNative&&(window.coreNativeHandler=function(e){t.receive(JSON.parse(e))})}var st=(Object.defineProperty(ot,"instance",{get:function(){return null==this._instance&&(this._instance=new ot),this._instance},enumerable:!0,configurable:!0}),ot.prototype.open=function(t){return a(this,void 0,void 0,function(){return v(this,function(e){switch(e.label){case 0:return this.webSocketUrl=t,[4,this.build()];case 1:return[2,e.sent()]}})})},ot.prototype.build=function(){var i=this;return new Promise(function(t){h("@WebSocket：发起连接---\x3e>>"+i.webSocketUrl);try{i.webSocket=new WebSocket(i.webSocketUrl),i.webSocket.binaryType="arraybuffer"}catch(e){return y("@WebSocket：打开连接出错 "+e),void(i.isOpen?te.instance.event(ie.CORE_WS_RECONNECTION_FAILUE):t(!1))}i.webSocket.onopen=function(e){i.isOpen=!0,h("@WebSocket：<<<---连接成功"),t(!0)},i.webSocket.onerror=function(e){y("@WebSocket：发生错误")},i.webSocket.onmessage=function(e){var t=e.data,n=ae.unpack(t);i.receive(n)},i.webSocket.onclose=function(e){h("@WebSocket：连接关闭"),cc.sys.isNative?console.error(JSON.stringify(e)):console.error(e),i.isOpen?(Ce.instance.closeShieldView(),e.code?i.closeWSConnection(e.code):i.closeWSConnection(oe.CORE_WS_NOT_NET)):t(!1)}})},ot.prototype.closeWSConnection=function(n){return a(this,void 0,void 0,function(){var t=this;return v(this,function(e){return this.close(),1006==n?(h("@WebSocket：连接异常关闭重新发起连接"),S.isNet&&te.instance.event(ie.CORE_WS_DISCONNECT),setTimeout(function(){t.restartWebSocket()},2e3)):Ve.instance.checkCode(n),[2]})})},ot.prototype.restartWebSocket=function(){return a(this,void 0,void 0,function(){return v(this,function(e){switch(e.label){case 0:return this.reconnectionNum++,3<this.reconnectionNum?(S.isNet&&te.instance.event(ie.CORE_WS_RECONNECTION_FAILUE),[2]):[4,this.build()];case 1:return e.sent()?(S.isNet&&te.instance.event(ie.CORE_WS_RECONNECTION_SUCCES),this.reconnectionNum=0,this.cleanRequestQueue()):this.restartWebSocket(),[2]}})})},ot.prototype.send=function(n,i,s){var o=this;if(this.isOpen){if(ae.isProtocol())return new Promise(function(e){var t={msg:i,name:n,callback:e,tag:s};o.requestQueue.push(t),1<o.requestQueue.length?h("@WebSocket：当前有未完成的通讯，把当前协议放入队列"):(s||Ce.instance.openShieldView(!0),o.upMessage(t))});y("@WebSockets：protocol文件不存在无法使用Protobuf")}else y("@WebSocket：连接没有建立")},ot.prototype.sendUDP=function(e,t){var n;this.isOpen?ae.isProtocol()?(this.logSend({uri:e,msg:t,action:"udp"}),n=ae.pack(e,t,"udp"),this.webSocket.send(n)):y("@WebSockets：protocol文件不存在无法使用Protobuf"):y("@WebSocket：连接没有建立")},ot.prototype.receive=function(e){var t=e.code,n=e.action,i=e.uri;this.logReceive(e),t==oe.CORE_ERROR_CODE_NONE?(i||y("@WebSocket：后台发送的协议没有uri协议标识"),n||y("@WebSocket：后台发送的协议没有action行为"),n==c.AGREEMENT_TYPE_PUSH?ke.instance.setPushData(i,e.data):n==c.AGREEMENT_TYPE_REQUEST&&this.downMessage(e.data)):(Ce.instance.closeShieldView(),n==c.AGREEMENT_TYPE_REQUEST&&this.downMessage(null),Ve.instance.checkCode(t))},ot.prototype.upMessage=function(e){e.tag||Ce.instance.openShieldView(!0),this.logSend({uri:e.name,data:e.msg,action:"request"});var t=ae.pack(e.name,e.msg,"request");this.webSocket.send(t)},ot.prototype.downMessage=function(e){var t=this.requestQueue[0];t&&(t.callback&&t.callback(e),this.requestQueue.splice(0,1)),this.retrieveRequestQueue()&&Ce.instance.closeShieldView()},ot.prototype.close=function(){this.isOpen&&this.webSocket&&(this.webSocket.onerror=null,this.webSocket.onclose=null,this.webSocket.close(),this.webSocket=null,this.isOpen=!1,this.requestQueue=[],this.reconnectionNum=0,h("@WebSocket：\b客户端已经关闭连接"))},ot.prototype.retrieveRequestQueue=function(){if(this.requestQueue.length){var e=this.requestQueue[0];return this.upMessage(e),!1}return!0},ot.prototype.cleanRequestQueue=function(){this.requestQueue=[]},ot.prototype.logSend=function(e){u.debugType==c.DEBUG_TYPE_1?S.isNative?cc.log("webSocket ==> ",JSON.stringify(e)):cc.log("webSocket %c ==> ","color:red;background-color:rgba(167, 167, 167, 0.2)",e):h("@WebSocket：发送消息 "+JSON.stringify(e))},ot.prototype.logReceive=function(e){u.debugType==c.DEBUG_TYPE_1?S.isNative?cc.log("webSocket <== ",JSON.stringify(e)):cc.log("webSocket %c <== ","color:green;background-color:rgba(167, 167, 167, 0.2)",e):h("@WebSocket：收到消息 "+JSON.stringify(e))},ot._instance=null,ot);function ot(){this.webSocketUrl=null,this.requestQueue=[],this.isOpen=!1,this.reconnectionNum=0}var rt=Ce.instance,at=te.instance,ct=et.instance,ut=$.instance,lt=we.instance,ht=st.instance,pt=nt.instance;e.ApplicationLogic=Pe,e.Audio=He,e.Base64=K,e.BaseConfig=u,e.BaseLogic=xe,e.BaseModel=D,e.BaseTableData=U,e.CommonFun=q,e.ComponentLogic=Ke,e.CoreCodeMap=oe,e.CoreEventMap=ie,e.CreateFun=B,e.EUpdateState=d,e.EViewStyle={NO_FULL:0,FULL:1},e.EventManager=te,e.HotUpdate=_,e.HttpRequest=et,e.Res=We,e.ResManager=$,e.ShellRequest=nt,e.Skeleton=Ge,e.StaticConfig=c,e.SystemConfig=S,e.Timer=je,e.ViewAdaptation=A,e.ViewLogic=Ze,e.ViewManager=Ce,e.WebSockets=st,e.audioManager=lt,e.code=function(){for(var s=[],e=0;e<arguments.length;e++)s[e]=arguments[e];return function(e,t,n){e.classId||(e.classId=z());for(var i=0;i<s.length;i++)Y.instance.onCode(e.classId,s[i],t);return n}},e.error=function(e){r.instance.error(e)},e.event=function(i){return function(e,t,n){return e.classId||(e.classId=z()),Y.instance.onEvent(e.classId,i,t),n}},e.eventManager=at,e.field=function(n,i){delete n[i]&&Object.defineProperty(n.constructor.prototype,i,{get:function(){return this["_"+i]},set:function(e){var t=this["_"+i];this["_"+i]=e,n.touch.call(this,i,e,t)},enumerable:!0,configurable:!0})},e.httpRequest=ct,e.instance=function(i){return function(e,t,n){return e.classId||(e.classId=z()),Y.instance.onInstance(e.classId,i,t),n}},e.log=function(e){r.instance.log(e)},e.module=function(i){return function(e,t,n){return e.classId||(e.classId=z()),Y.instance.onModule(e.classId,i,t),n}},e.netPush=function(i){return function(e,t,n){return e.classId||(e.classId=z()),Y.instance.onNetPush(e.classId,i,t),n}},e.resManager=ut,e.shellRequest=pt,e.viewManager=rt,e.webSockets=ht,Object.defineProperty(e,"__esModule",{value:!0})});